<!DOCTYPE html>
<html>
<head>
  <title>iFrame Dynamic Loader</title>
  <style>
    #myFrame {
      width: 100%;
      border: none;
    }
  </style>
</head>
<body>
  <h2>Dynamic iFrame Loader</h2>
  <iframe id="myFrame" onload="sendHeightToParent()"></iframe>

  <script>
    function sendHeightToParent() {
      const iframe = document.getElementById("myFrame");

      // This message is sent to the parent window
      iframe.contentWindow?.postMessage({
        type: "resize-iframe",
        height: iframe.scrollHeight || iframe.contentDocument?.body?.scrollHeight || 600
      }, "*");
    }

    // Step 1: Call the API
    fetch('https://apim.workato.com/enricom0/embedded-v1/function-call-will-create-list?api_token=7e10da2682db74dddc4d70305d3f382c9351c73761574aa033b186c6532f8149') // replace with your actual API endpoint
      .then(response => response.json())
      .then(data => {
        const token = data.token;

        // Step 2: Build the new URL
        const newUrl = `https://app.workato.com/direct_link/embedded/connections/17715839?workato_dl_token=${token}`;

        // Step 3: Update the iframe src
        const frame = document.getElementById('myFrame');
        frame.src = newUrl;
      })
      .catch(error => {
        console.error('Error fetching API:', error);
      });
  </script>
</body>
</html>
